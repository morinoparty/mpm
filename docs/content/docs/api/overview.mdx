---
title: API Overview
description: MinecraftPluginManagerの公開APIについて
---

MinecraftPluginManagerは、他のプラグインやアドオンから利用できる公開APIを提供しています。
このAPIを使用することで、プラグインの管理機能をプログラムから制御することができます。

## API取得方法

MinecraftPluginManagerのAPIは、`MpmAPI`インターフェースを通じて提供されます。

### Bukkit APIを使用して取得

```kotlin
import org.bukkit.Bukkit
import party.morino.mpm.api.MpmAPI

// プラグインインスタンスを取得
val mpmPlugin = Bukkit.getPluginManager().getPlugin("MinecraftPluginManager")

// APIにキャスト
if (mpmPlugin is MpmAPI) {
    val api: MpmAPI = mpmPlugin
    // APIを使用
}
```

### 依存関係の設定

APIを使用するには、`build.gradle.kts`に以下の依存関係を追加してください：

```kotlin
dependencies {
    compileOnly("party.morino.mpm:api:VERSION")
}
```

また、`plugin.yml`または`paper-plugin.yml`でMinecraftPluginManagerを依存関係として指定してください：

```yaml
# plugin.yml
depend: [MinecraftPluginManager]
```

```yaml
# paper-plugin.yml
dependencies:
  server:
    MinecraftPluginManager:
      required: true
      load: BEFORE
      join-classpath: true
```

## 利用可能なサービス・マネージャー

MpmAPIは、以下のサービス・マネージャーへのアクセスを提供します：

### ConfigManager
設定ファイル（mpm.json）の読み込みと再読み込みを担当します。

```kotlin
val configManager = api.getConfigManager()
val config = configManager.getConfig()
```

### PluginDirectory
プラグインディレクトリやデータディレクトリのパス管理を担当します。

```kotlin
val pluginDirectory = api.getPluginDirectory()
val dataDir = pluginDirectory.getDataDirectory()
```

### PluginInfoService
プラグインの情報取得やリスト表示を担当します。

```kotlin
val pluginInfoService = api.getPluginInfoService()
val plugins = pluginInfoService.list()
```

### PluginLifecycleService
プラグインのインストール、削除、有効化/無効化を担当します。

```kotlin
val lifecycleService = api.getPluginLifecycleService()
// プラグインのインストール
lifecycleService.install(PluginName("PluginName"))
```

### PluginUpdateService
プラグインの更新チェックとアップデートを担当します。

```kotlin
val updateService = api.getPluginUpdateService()
val outdated = updateService.checkOutdatedAll()
```

### PluginMetadataManager
プラグインのメタデータ管理を担当します。

```kotlin
val metadataManager = api.getPluginMetadataManager()
val metadata = metadataManager.getPluginMetadata("PluginName")
```

### ProjectService
プロジェクトの初期化と管理を担当します。

```kotlin
val projectService = api.getProjectService()
projectService.init("server", overwrite = false)
```

### RepositoryManager
リポジトリソースの管理を担当します。

```kotlin
val repositoryManager = api.getRepositoryManager()
val availablePlugins = repositoryManager.getAvailablePlugins()
```

## 使用例

### プラグインの情報を取得する

```kotlin
import org.bukkit.Bukkit
import party.morino.mpm.api.MpmAPI
import kotlinx.coroutines.runBlocking

fun getPluginInfo(pluginName: String) {
    val mpmPlugin = Bukkit.getPluginManager().getPlugin("MinecraftPluginManager")

    if (mpmPlugin is MpmAPI) {
        val pluginInfoService = mpmPlugin.getPluginInfoService()

        runBlocking {
            val plugins = pluginInfoService.list()
            val plugin = plugins.find { it.name.value == pluginName }
            if (plugin != null) {
                println("プラグイン名: ${plugin.name.value}")
                println("バージョン: ${plugin.currentVersion}")
            }
        }
    }
}
```

### プラグインをインストールする

```kotlin
import org.bukkit.Bukkit
import party.morino.mpm.api.MpmAPI
import party.morino.mpm.api.domain.plugin.model.PluginName
import kotlinx.coroutines.runBlocking

fun installPlugin(pluginName: String) {
    val mpmPlugin = Bukkit.getPluginManager().getPlugin("MinecraftPluginManager")

    if (mpmPlugin is MpmAPI) {
        val lifecycleService = mpmPlugin.getPluginLifecycleService()

        runBlocking {
            val result = lifecycleService.install(PluginName(pluginName))
            result.fold(
                { error -> println("エラー: ${error.message}") },
                { println("プラグインのインストールに成功しました") }
            )
        }
    }
}
```

### 更新が必要なプラグインをチェックする

```kotlin
import org.bukkit.Bukkit
import party.morino.mpm.api.MpmAPI
import kotlinx.coroutines.runBlocking

fun checkOutdatedPlugins() {
    val mpmPlugin = Bukkit.getPluginManager().getPlugin("MinecraftPluginManager")

    if (mpmPlugin is MpmAPI) {
        val updateService = mpmPlugin.getPluginUpdateService()

        runBlocking {
            val result = updateService.checkOutdatedAll()
            result.fold(
                { error -> println("エラー: ${error.message}") },
                { outdatedList ->
                    outdatedList.forEach { info ->
                        println("${info.name}: ${info.currentVersion} -> ${info.latestVersion}")
                    }
                }
            )
        }
    }
}
```

## 注意事項

- ほとんどのAPI呼び出しは`suspend`関数です。Kotlinのコルーチンを使用してください。
- API呼び出しは失敗する可能性があります。Arrow-ktの`Either`型で結果を返すため、適切にエラーハンドリングを行ってください。
- プラグインのインストールや更新などの操作は、サーバーのパフォーマンスに影響を与える可能性があります。適切なタイミングで実行してください。

## 詳細なドキュメント

各マネージャーの詳細な使用方法については、APIのソースコードに含まれるKDocを参照してください。すべてのインターフェースとメソッドには詳細なドキュメントが含まれています。
